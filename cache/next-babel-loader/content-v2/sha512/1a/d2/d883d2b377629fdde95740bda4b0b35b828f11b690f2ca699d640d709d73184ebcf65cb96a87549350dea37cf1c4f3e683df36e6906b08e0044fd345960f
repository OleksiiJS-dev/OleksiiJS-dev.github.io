{"ast":null,"code":"import { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport _toConsumableArray from \"C:/Users/user/Documents/GitHub/blind-blind/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport { useEffect, useState } from 'react';\nimport { useRouter } from 'next/router';\nimport GoodsItem, { GoodsItemFallback } from './GoodsItem';\nimport Dropdown from '../Form/Dropdown';\nimport SuccessSVG from '../../assets/svg/success.svg';\nimport CrossSVG from '../../assets/svg/cross.svg';\nimport { SORT_GOODS, SORT_TRANSLATE } from '../../constants/sortGoods';\nimport { TRANSLATE } from '../../constants/languages';\nvar GOODS_ON_PAGE = 12;\nvar AVAILABLE_PAGES = 3;\n\nvar GoodsList = function GoodsList(_ref) {\n  var goods = _ref.goods,\n      categories = _ref.categories;\n\n  var _useState = useState('default'),\n      sortSelect = _useState[0],\n      setSortSelect = _useState[1];\n\n  var router = useRouter();\n  var locale = router.locale,\n      query = router.query;\n\n  var _useState2 = useState(false),\n      isCategoriesOpen = _useState2[0],\n      setCategoriesOpen = _useState2[1];\n\n  var _useState3 = useState([]),\n      selectedCategories = _useState3[0],\n      setSelectedCategories = _useState3[1];\n\n  var _useState4 = useState(1),\n      currentPage = _useState4[0],\n      setCurrentPage = _useState4[1];\n\n  var _useState5 = useState([]),\n      visiblePages = _useState5[0],\n      setVisiblePages = _useState5[1];\n\n  var _useState6 = useState(1),\n      firstGoodsOnPageIndex = _useState6[0],\n      setFirstGoodsOnPageIndex = _useState6[1];\n\n  var filteredGoods = goods === null || goods === void 0 ? void 0 : goods.entries.filter(function (_ref2) {\n    var categories = _ref2.categories;\n    return selectedCategories.length == 0 || Array.isArray(categories) && categories.reduce(function (prev, _ref3) {\n      var _id = _ref3._id;\n      return selectedCategories.includes(_id) || prev;\n    }, false);\n  });\n  var sortedGoods = SORT_GOODS[sortSelect](filteredGoods);\n  var maxPageNumber = Math.ceil((sortedGoods === null || sortedGoods === void 0 ? void 0 : sortedGoods.length) / GOODS_ON_PAGE);\n  useEffect(function () {\n    var outsideClick = function outsideClick() {\n      return setCategoriesOpen(function () {\n        return false;\n      });\n    };\n\n    document && document.addEventListener('click', outsideClick, {\n      passive: true\n    });\n    return function () {\n      return document && document.removeEventListener('click', outsideClick);\n    };\n  }, []);\n  useEffect(function () {\n    setFirstGoodsOnPageIndex((currentPage - 1) * GOODS_ON_PAGE);\n    if (maxPageNumber <= 1) setVisiblePages([]);else if (currentPage + 1 + AVAILABLE_PAGES >= maxPageNumber) setVisiblePages(_toConsumableArray(Array(maxPageNumber + 1).keys()).splice(maxPageNumber > AVAILABLE_PAGES ? maxPageNumber - AVAILABLE_PAGES : 1, maxPageNumber));else if (currentPage + 1 - AVAILABLE_PAGES <= 0) setVisiblePages(_toConsumableArray(Array(maxPageNumber + 1).keys()).splice(1, AVAILABLE_PAGES));else setVisiblePages(_toConsumableArray(Array(maxPageNumber + 1).keys()).splice(currentPage - Math.floor(AVAILABLE_PAGES / 2), currentPage + Math.ceil(AVAILABLE_PAGES / 2) - 1));\n  }, [currentPage, maxPageNumber]);\n  useEffect(function () {\n    var page = query.page ? Number.parseInt(query.page) : 0;\n    setCurrentPage(page && page < maxPageNumber + 1 ? page : 1);\n  }, [query.page, maxPageNumber]);\n  useEffect(function () {\n    if (selectedCategories.length) {\n      setCurrentPage(1);\n      var newQuery = router.query;\n      newQuery['page'] = '1';\n      router.push({\n        pathname: router.pathname,\n        query: newQuery\n      });\n    }\n  }, [selectedCategories]);\n\n  var changePage = function changePage(pageNum) {\n    var newQuery = router.query;\n\n    if (!pageNum) {\n      delete newQuery.page;\n    } else {\n      newQuery['page'] = pageNum.toString();\n    }\n\n    router.push({\n      pathname: router.pathname,\n      query: newQuery\n    });\n    window.scrollTo({\n      top: 0,\n      behavior: 'smooth'\n    });\n  };\n\n  var setSort = function setSort(item) {\n    setSortSelect(Object.keys(SORT_TRANSLATE).find(function (key) {\n      return SORT_TRANSLATE[key][locale] === item;\n    }));\n  };\n\n  return /*#__PURE__*/_jsxs(\"div\", {\n    className: \"goods-list\",\n    children: [/*#__PURE__*/_jsxs(\"div\", {\n      className: \"input-select\",\n      children: [/*#__PURE__*/_jsxs(\"div\", {\n        role: \"presentation\",\n        className: \"dropdown\",\n        onClick: function onClick(e) {\n          e.stopPropagation();\n          setCategoriesOpen(function (prev) {\n            return !prev;\n          });\n        },\n        children: [/*#__PURE__*/_jsxs(\"div\", {\n          className: \"dropdown__value\",\n          children: [TRANSLATE[locale].goodsCaterories, /*#__PURE__*/_jsx(\"div\", {\n            className: \"dropdown-button\"\n          })]\n        }), /*#__PURE__*/_jsx(\"div\", {\n          className: \"dropdown__list goods-list-categories__list \".concat(isCategoriesOpen ? 'open' : ''),\n          children: categories.map(function (_ref4) {\n            var _id = _ref4._id,\n                title = _ref4.title;\n            return /*#__PURE__*/_jsx(\"div\", {\n              className: \"goods-list-categories__list-item\",\n              role: \"presentation\",\n              onClick: function onClick() {\n                setSelectedCategories(function (prev) {\n                  return prev.includes(_id) ? prev.filter(function (id) {\n                    return id != _id;\n                  }) : [].concat(_toConsumableArray(prev), [_id]);\n                });\n              },\n              children: /*#__PURE__*/_jsxs(\"div\", {\n                className: \"goods-list-categories__list-item-label\",\n                children: [/*#__PURE__*/_jsx(\"div\", {\n                  className: \"goods-list-categories__list-item-label-box \".concat(selectedCategories.includes(_id) ? 'goods-list-categories__list-item-label-box-selected' : ''),\n                  children: /*#__PURE__*/_jsx(SuccessSVG, {})\n                }), title]\n              })\n            }, _id);\n          })\n        })]\n      }), /*#__PURE__*/_jsx(Dropdown, {\n        value: SORT_TRANSLATE[sortSelect][locale],\n        values: Object.keys(SORT_TRANSLATE).map(function (key) {\n          return SORT_TRANSLATE[key][locale];\n        }),\n        setValue: setSort\n      })]\n    }), /*#__PURE__*/_jsx(\"div\", {\n      className: \"goods-list__categories\",\n      children: categories.filter(function (_ref5) {\n        var _id = _ref5._id;\n        return selectedCategories.includes(_id);\n      }).map(function (_ref6) {\n        var _id = _ref6._id,\n            title = _ref6.title;\n        return /*#__PURE__*/_jsxs(\"div\", {\n          role: \"presentation\",\n          className: \"goods-list__categories-title\",\n          onClick: function onClick() {\n            return setSelectedCategories(function (prev) {\n              return prev.filter(function (id) {\n                return id != _id;\n              });\n            });\n          },\n          children: [title, /*#__PURE__*/_jsx(CrossSVG, {})]\n        }, _id);\n      })\n    }), /*#__PURE__*/_jsx(\"div\", {\n      className: \"goods-list__goods-container\",\n      children: sortedGoods.slice(firstGoodsOnPageIndex, firstGoodsOnPageIndex + GOODS_ON_PAGE).map(function (_ref7) {\n        var _id = _ref7._id,\n            title = _ref7.title,\n            price = _ref7.price,\n            stockPrice = _ref7.stockPrice,\n            link = _ref7.link,\n            previewImage = _ref7.previewImage,\n            secondImage = _ref7.secondImage;\n        return /*#__PURE__*/_jsx(GoodsItem, {\n          title: title,\n          link: link,\n          photo: previewImage.path,\n          secondPhoto: (secondImage === null || secondImage === void 0 ? void 0 : secondImage.path) || undefined,\n          price: price,\n          stockPrice: stockPrice\n        }, _id);\n      })\n    }), /*#__PURE__*/_jsxs(\"div\", {\n      className: \"goods-list__pages-buttons\",\n      children: [currentPage > 1 && /*#__PURE__*/_jsx(\"div\", {\n        role: \"presentation\",\n        onClick: function onClick() {\n          return changePage(currentPage - 1);\n        },\n        className: \"chevron-left\"\n      }), visiblePages.map(function (pageNum) {\n        return /*#__PURE__*/_jsx(\"div\", {\n          className: \"page-number\",\n          children: /*#__PURE__*/_jsx(\"p\", {\n            role: \"presentation\",\n            onClick: function onClick() {\n              return changePage(pageNum);\n            },\n            className: pageNum === currentPage ? 'selected' : '',\n            children: pageNum\n          })\n        }, pageNum);\n      }), currentPage < maxPageNumber - 1 && /*#__PURE__*/_jsx(\"div\", {\n        role: \"presentation\",\n        onClick: function onClick() {\n          return changePage(currentPage + 1);\n        },\n        className: \"chevron-right\"\n      })]\n    })]\n  });\n};\n\nexport var GoodsListFallback = function GoodsListFallback() {\n  return /*#__PURE__*/_jsx(\"div\", {\n    className: \"goods-list-fallback\",\n    children: /*#__PURE__*/_jsx(\"div\", {\n      className: \"goods-list-fallback__goods-container\",\n      children: Array.from({\n        length: 9\n      }, function (_, index) {\n        return /*#__PURE__*/_jsx(GoodsItemFallback, {}, index);\n      })\n    })\n  });\n};\nexport default GoodsList;","map":null,"metadata":{},"sourceType":"module"}