{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport _toConsumableArray from \"D:/archivegit/blind-blind/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\n\nvar _jsxFileName = \"D:\\\\archivegit\\\\blind-blind\\\\src\\\\components\\\\Goods\\\\GoodsList.tsx\",\n    _this = this,\n    _s = $RefreshSig$();\n\nimport { useEffect, useState } from 'react';\nimport { useRouter } from 'next/router';\nimport GoodsItem, { GoodsItemFallback } from './GoodsItem';\nimport Dropdown from '../Form/Dropdown';\nimport SuccessSVG from '../../assets/svg/success.svg';\nimport CrossSVG from '../../assets/svg/cross.svg';\nimport { SORT_GOODS, SORT_TRANSLATE } from '../../constants/sortGoods';\nimport { TRANSLATE } from '../../constants/languages';\nvar GOODS_ON_PAGE = 12;\nvar AVAILABLE_PAGES = 3;\n\nvar GoodsList = function GoodsList(_ref) {\n  _s();\n\n  var goods = _ref.goods,\n      categories = _ref.categories;\n\n  var _useState = useState('default'),\n      sortSelect = _useState[0],\n      setSortSelect = _useState[1];\n\n  var router = useRouter();\n  var locale = router.locale,\n      query = router.query;\n\n  var _useState2 = useState(false),\n      isCategoriesOpen = _useState2[0],\n      setCategoriesOpen = _useState2[1];\n\n  var _useState3 = useState([]),\n      selectedCategories = _useState3[0],\n      setSelectedCategories = _useState3[1];\n\n  var _useState4 = useState(1),\n      currentPage = _useState4[0],\n      setCurrentPage = _useState4[1];\n\n  var _useState5 = useState([]),\n      visiblePages = _useState5[0],\n      setVisiblePages = _useState5[1];\n\n  var _useState6 = useState(1),\n      firstGoodsOnPageIndex = _useState6[0],\n      setFirstGoodsOnPageIndex = _useState6[1];\n\n  var filteredGoods = goods === null || goods === void 0 ? void 0 : goods.entries.filter(function (_ref2) {\n    var categories = _ref2.categories;\n    return selectedCategories.length == 0 || Array.isArray(categories) && categories.reduce(function (prev, _ref3) {\n      var _id = _ref3._id;\n      return selectedCategories.includes(_id) || prev;\n    }, false);\n  });\n  var sortedGoods = SORT_GOODS[sortSelect](filteredGoods);\n  var maxPageNumber = Math.ceil((sortedGoods === null || sortedGoods === void 0 ? void 0 : sortedGoods.length) / GOODS_ON_PAGE);\n  useEffect(function () {\n    var outsideClick = function outsideClick() {\n      return setCategoriesOpen(function () {\n        return false;\n      });\n    };\n\n    document && document.addEventListener('click', outsideClick, {\n      passive: true\n    });\n    return function () {\n      return document && document.removeEventListener('click', outsideClick);\n    };\n  }, []);\n  useEffect(function () {\n    setFirstGoodsOnPageIndex((currentPage - 1) * GOODS_ON_PAGE);\n    if (maxPageNumber <= 1) setVisiblePages([]);else if (currentPage + 1 + AVAILABLE_PAGES >= maxPageNumber) setVisiblePages(_toConsumableArray(Array(maxPageNumber + 1).keys()).splice(maxPageNumber > AVAILABLE_PAGES ? maxPageNumber - AVAILABLE_PAGES : 1, maxPageNumber));else if (currentPage + 1 - AVAILABLE_PAGES <= 0) setVisiblePages(_toConsumableArray(Array(maxPageNumber + 1).keys()).splice(1, AVAILABLE_PAGES));else setVisiblePages(_toConsumableArray(Array(maxPageNumber + 1).keys()).splice(currentPage - Math.floor(AVAILABLE_PAGES / 2), currentPage + Math.ceil(AVAILABLE_PAGES / 2) - 1));\n  }, [currentPage, maxPageNumber]);\n  useEffect(function () {\n    var page = query.page ? Number.parseInt(query.page) : 0;\n    setCurrentPage(page && page < maxPageNumber + 1 ? page : 1);\n  }, [query.page, maxPageNumber]);\n  useEffect(function () {\n    if (selectedCategories.length) {\n      setCurrentPage(1);\n      var newQuery = router.query;\n      newQuery['page'] = '1';\n      router.push({\n        pathname: router.pathname,\n        query: newQuery\n      });\n    }\n  }, [selectedCategories]);\n\n  var changePage = function changePage(pageNum) {\n    var newQuery = router.query;\n\n    if (!pageNum) {\n      delete newQuery.page;\n    } else {\n      newQuery['page'] = pageNum.toString();\n    }\n\n    router.push({\n      pathname: router.pathname,\n      query: newQuery\n    });\n    window.scrollTo({\n      top: 0,\n      behavior: 'smooth'\n    });\n  };\n\n  var setSort = function setSort(item) {\n    setSortSelect(Object.keys(SORT_TRANSLATE).find(function (key) {\n      return SORT_TRANSLATE[key][locale] === item;\n    }));\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"goods-list\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"input-select\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        role: \"presentation\",\n        className: \"dropdown\",\n        onClick: function onClick(e) {\n          e.stopPropagation();\n          setCategoriesOpen(function (prev) {\n            return !prev;\n          });\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"dropdown__value\",\n          children: [TRANSLATE[locale].goodsCaterories, /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"dropdown-button\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 134,\n            columnNumber: 13\n          }, _this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 132,\n          columnNumber: 11\n        }, _this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"dropdown__list goods-list-categories__list \".concat(isCategoriesOpen ? 'open' : ''),\n          children: categories.map(function (_ref4) {\n            var _id = _ref4._id,\n                title = _ref4.title;\n            return /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"goods-list-categories__list-item\",\n              role: \"presentation\",\n              onClick: function onClick() {\n                setSelectedCategories(function (prev) {\n                  return prev.includes(_id) ? prev.filter(function (id) {\n                    return id != _id;\n                  }) : [].concat(_toConsumableArray(prev), [_id]);\n                });\n              },\n              children: /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"goods-list-categories__list-item-label\",\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"goods-list-categories__list-item-label-box \".concat(selectedCategories.includes(_id) ? 'goods-list-categories__list-item-label-box-selected' : ''),\n                  children: /*#__PURE__*/_jsxDEV(SuccessSVG, {}, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 162,\n                    columnNumber: 21\n                  }, _this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 155,\n                  columnNumber: 19\n                }, _this), title]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 154,\n                columnNumber: 17\n              }, _this)\n            }, _id, false, {\n              fileName: _jsxFileName,\n              lineNumber: 142,\n              columnNumber: 15\n            }, _this);\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 136,\n          columnNumber: 11\n        }, _this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 124,\n        columnNumber: 9\n      }, _this), /*#__PURE__*/_jsxDEV(Dropdown, {\n        value: SORT_TRANSLATE[sortSelect][locale],\n        values: Object.keys(SORT_TRANSLATE).map(function (key) {\n          return SORT_TRANSLATE[key][locale];\n        }),\n        setValue: setSort\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 171,\n        columnNumber: 9\n      }, _this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 123,\n      columnNumber: 7\n    }, _this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"goods-list__categories\",\n      children: categories.filter(function (_ref5) {\n        var _id = _ref5._id;\n        return selectedCategories.includes(_id);\n      }).map(function (_ref6) {\n        var _id = _ref6._id,\n            title = _ref6.title;\n        return /*#__PURE__*/_jsxDEV(\"div\", {\n          role: \"presentation\",\n          className: \"goods-list__categories-title\",\n          onClick: function onClick() {\n            return setSelectedCategories(function (prev) {\n              return prev.filter(function (id) {\n                return id != _id;\n              });\n            });\n          },\n          children: [title, /*#__PURE__*/_jsxDEV(CrossSVG, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 195,\n            columnNumber: 15\n          }, _this)]\n        }, _id, true, {\n          fileName: _jsxFileName,\n          lineNumber: 186,\n          columnNumber: 13\n        }, _this);\n      })\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 182,\n      columnNumber: 7\n    }, _this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"goods-list__goods-container\",\n      children: sortedGoods.slice(firstGoodsOnPageIndex, firstGoodsOnPageIndex + GOODS_ON_PAGE).map(function (_ref7) {\n        var _id = _ref7._id,\n            title = _ref7.title,\n            price = _ref7.price,\n            stockPrice = _ref7.stockPrice,\n            link = _ref7.link,\n            previewImage = _ref7.previewImage,\n            secondImage = _ref7.secondImage;\n        return /*#__PURE__*/_jsxDEV(GoodsItem, {\n          title: title,\n          link: link,\n          photo: previewImage.path,\n          secondPhoto: (secondImage === null || secondImage === void 0 ? void 0 : secondImage.path) || undefined,\n          price: price,\n          stockPrice: stockPrice\n        }, _id, false, {\n          fileName: _jsxFileName,\n          lineNumber: 212,\n          columnNumber: 15\n        }, _this);\n      })\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 199,\n      columnNumber: 7\n    }, _this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"goods-list__pages-buttons\",\n      children: [currentPage > 1 && /*#__PURE__*/_jsxDEV(\"div\", {\n        role: \"presentation\",\n        onClick: function onClick() {\n          return changePage(currentPage - 1);\n        },\n        className: \"chevron-left\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 226,\n        columnNumber: 11\n      }, _this), visiblePages.map(function (pageNum) {\n        return /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"page-number\",\n          children: /*#__PURE__*/_jsxDEV(\"p\", {\n            role: \"presentation\",\n            onClick: function onClick() {\n              return changePage(pageNum);\n            },\n            className: pageNum === currentPage ? 'selected' : '',\n            children: pageNum\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 234,\n            columnNumber: 13\n          }, _this)\n        }, pageNum, false, {\n          fileName: _jsxFileName,\n          lineNumber: 233,\n          columnNumber: 11\n        }, _this);\n      }), currentPage < maxPageNumber - 1 && /*#__PURE__*/_jsxDEV(\"div\", {\n        role: \"presentation\",\n        onClick: function onClick() {\n          return changePage(currentPage + 1);\n        },\n        className: \"chevron-right\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 244,\n        columnNumber: 11\n      }, _this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 224,\n      columnNumber: 7\n    }, _this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 122,\n    columnNumber: 5\n  }, _this);\n};\n\n_s(GoodsList, \"0yAq9C5cY1OsW5utGMNBqSu+GnA=\", false, function () {\n  return [useRouter];\n});\n\n_c = GoodsList;\nexport var GoodsListFallback = function GoodsListFallback() {\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"goods-list-fallback\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"goods-list-fallback__goods-container\",\n      children: Array.from({\n        length: 9\n      }, function (_, index) {\n        return /*#__PURE__*/_jsxDEV(GoodsItemFallback, {}, index, false, {\n          fileName: _jsxFileName,\n          lineNumber: 260,\n          columnNumber: 11\n        }, _this);\n      })\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 258,\n      columnNumber: 7\n    }, _this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 257,\n    columnNumber: 5\n  }, _this);\n};\n_c2 = GoodsListFallback;\nexport default GoodsList;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"GoodsList\");\n$RefreshReg$(_c2, \"GoodsListFallback\");","map":{"version":3,"sources":["D:/archivegit/blind-blind/src/components/Goods/GoodsList.tsx"],"names":["useEffect","useState","useRouter","GoodsItem","GoodsItemFallback","Dropdown","SuccessSVG","CrossSVG","SORT_GOODS","SORT_TRANSLATE","TRANSLATE","GOODS_ON_PAGE","AVAILABLE_PAGES","GoodsList","goods","categories","sortSelect","setSortSelect","router","locale","query","isCategoriesOpen","setCategoriesOpen","selectedCategories","setSelectedCategories","currentPage","setCurrentPage","visiblePages","setVisiblePages","firstGoodsOnPageIndex","setFirstGoodsOnPageIndex","filteredGoods","entries","filter","length","Array","isArray","reduce","prev","_id","includes","sortedGoods","maxPageNumber","Math","ceil","outsideClick","document","addEventListener","passive","removeEventListener","keys","splice","floor","page","Number","parseInt","newQuery","push","pathname","changePage","pageNum","toString","window","scrollTo","top","behavior","setSort","item","Object","find","key","e","stopPropagation","goodsCaterories","map","title","id","slice","price","stockPrice","link","previewImage","secondImage","path","undefined","GoodsListFallback","from","_","index"],"mappings":"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","sourcesContent":["import { useEffect, useState } from 'react';\r\nimport { useRouter } from 'next/router';\r\n\r\nimport GoodsItem, { GoodsItemFallback } from './GoodsItem';\r\nimport Dropdown from '../Form/Dropdown';\r\n\r\nimport { ICockpitGoodsRaw } from '../../cockpitTypes';\r\nimport { IGoodsListProps } from './Types';\r\n\r\nimport SuccessSVG from '../../assets/svg/success.svg';\r\nimport CrossSVG from '../../assets/svg/cross.svg';\r\n\r\nimport { SORT_GOODS, SORT_TRANSLATE } from '../../constants/sortGoods';\r\nimport { TRANSLATE } from '../../constants/languages';\r\n\r\nconst GOODS_ON_PAGE = 12;\r\nconst AVAILABLE_PAGES = 3;\r\n\r\nconst GoodsList: React.FC<IGoodsListProps> = ({ goods, categories }) => {\r\n  const [sortSelect, setSortSelect] = useState<keyof typeof SORT_TRANSLATE>(\r\n    'default'\r\n  );\r\n  const router = useRouter();\r\n  const { locale, query } = router;\r\n\r\n  const [isCategoriesOpen, setCategoriesOpen] = useState(false);\r\n  const [selectedCategories, setSelectedCategories] = useState<string[]>([]);\r\n\r\n  const [currentPage, setCurrentPage] = useState(1);\r\n  const [visiblePages, setVisiblePages] = useState<Array<number>>([]);\r\n  const [firstGoodsOnPageIndex, setFirstGoodsOnPageIndex] = useState(1);\r\n\r\n  const filteredGoods = goods?.entries.filter(\r\n    ({ categories }) =>\r\n      selectedCategories.length == 0 ||\r\n      (Array.isArray(categories) &&\r\n        categories.reduce<boolean>(\r\n          (prev, { _id }) => selectedCategories.includes(_id) || prev,\r\n          false\r\n        ))\r\n  );\r\n\r\n  const sortedGoods = SORT_GOODS[sortSelect](\r\n    filteredGoods as ICockpitGoodsRaw[]\r\n  );\r\n\r\n  const maxPageNumber = Math.ceil(sortedGoods?.length / GOODS_ON_PAGE);\r\n\r\n  useEffect(() => {\r\n    const outsideClick = () => setCategoriesOpen(() => false);\r\n    document &&\r\n      document.addEventListener('click', outsideClick, { passive: true });\r\n    return () =>\r\n      document && document.removeEventListener('click', outsideClick);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    setFirstGoodsOnPageIndex((currentPage - 1) * GOODS_ON_PAGE);\r\n    if (maxPageNumber <= 1) setVisiblePages([]);\r\n    else if (currentPage + 1 + AVAILABLE_PAGES >= maxPageNumber)\r\n      setVisiblePages(\r\n        [...Array(maxPageNumber + 1).keys()].splice(\r\n          maxPageNumber > AVAILABLE_PAGES ? maxPageNumber - AVAILABLE_PAGES : 1,\r\n          maxPageNumber\r\n        )\r\n      );\r\n    else if (currentPage + 1 - AVAILABLE_PAGES <= 0)\r\n      setVisiblePages(\r\n        [...Array(maxPageNumber + 1).keys()].splice(1, AVAILABLE_PAGES)\r\n      );\r\n    else\r\n      setVisiblePages(\r\n        [...Array(maxPageNumber + 1).keys()].splice(\r\n          currentPage - Math.floor(AVAILABLE_PAGES / 2),\r\n          currentPage + Math.ceil(AVAILABLE_PAGES / 2) - 1\r\n        )\r\n      );\r\n  }, [currentPage, maxPageNumber]);\r\n\r\n  useEffect(() => {\r\n    const page = query.page ? Number.parseInt(query.page as string) : 0;\r\n    setCurrentPage(page && page < maxPageNumber + 1 ? page : 1);\r\n  }, [query.page, maxPageNumber]);\r\n\r\n  useEffect(() => {\r\n    if (selectedCategories.length) {\r\n      setCurrentPage(1);\r\n      const newQuery = router.query;\r\n      newQuery['page'] = '1';\r\n      router.push({ pathname: router.pathname, query: newQuery });\r\n    }\r\n  }, [selectedCategories]);\r\n\r\n  const changePage = (pageNum: number) => {\r\n    const newQuery = router.query;\r\n    if (!pageNum) {\r\n      delete newQuery.page;\r\n    } else {\r\n      newQuery['page'] = pageNum.toString();\r\n    }\r\n\r\n    router.push({\r\n      pathname: router.pathname,\r\n      query: newQuery,\r\n    });\r\n\r\n    window.scrollTo({ top: 0, behavior: 'smooth' });\r\n  };\r\n\r\n  const setSort = (item: string) => {\r\n    setSortSelect(\r\n      Object.keys(SORT_TRANSLATE).find(\r\n        (key) =>\r\n          SORT_TRANSLATE[key as keyof typeof SORT_TRANSLATE][\r\n            locale as 'ru' | 'en'\r\n          ] === item\r\n      ) as keyof typeof SORT_TRANSLATE\r\n    );\r\n  };\r\n\r\n  return (\r\n    <div className=\"goods-list\">\r\n      <div className=\"input-select\">\r\n        <div\r\n          role=\"presentation\"\r\n          className=\"dropdown\"\r\n          onClick={(e) => {\r\n            e.stopPropagation();\r\n            setCategoriesOpen((prev) => !prev);\r\n          }}\r\n        >\r\n          <div className=\"dropdown__value\">\r\n            {TRANSLATE[locale as 'ru' | 'en'].goodsCaterories}\r\n            <div className=\"dropdown-button\" />\r\n          </div>\r\n          <div\r\n            className={`dropdown__list goods-list-categories__list ${\r\n              isCategoriesOpen ? 'open' : ''\r\n            }`}\r\n          >\r\n            {categories.map(({ _id, title }) => (\r\n              <div\r\n                key={_id}\r\n                className=\"goods-list-categories__list-item\"\r\n                role=\"presentation\"\r\n                onClick={() => {\r\n                  setSelectedCategories((prev) =>\r\n                    prev.includes(_id)\r\n                      ? prev.filter((id) => id != _id)\r\n                      : [...prev, _id]\r\n                  );\r\n                }}\r\n              >\r\n                <div className=\"goods-list-categories__list-item-label\">\r\n                  <div\r\n                    className={`goods-list-categories__list-item-label-box ${\r\n                      selectedCategories.includes(_id)\r\n                        ? 'goods-list-categories__list-item-label-box-selected'\r\n                        : ''\r\n                    }`}\r\n                  >\r\n                    <SuccessSVG />\r\n                  </div>\r\n\r\n                  {title}\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </div>\r\n        <Dropdown\r\n          value={SORT_TRANSLATE[sortSelect][locale as 'ru' | 'en']}\r\n          values={Object.keys(SORT_TRANSLATE).map(\r\n            (key) =>\r\n              SORT_TRANSLATE[key as keyof typeof SORT_TRANSLATE][\r\n                locale as 'ru' | 'en'\r\n              ]\r\n          )}\r\n          setValue={setSort}\r\n        />\r\n      </div>\r\n      <div className=\"goods-list__categories\">\r\n        {categories\r\n          .filter(({ _id }) => selectedCategories.includes(_id))\r\n          .map(({ _id, title }) => (\r\n            <div\r\n              role=\"presentation\"\r\n              key={_id}\r\n              className=\"goods-list__categories-title\"\r\n              onClick={() =>\r\n                setSelectedCategories((prev) => prev.filter((id) => id != _id))\r\n              }\r\n            >\r\n              {title}\r\n              <CrossSVG />\r\n            </div>\r\n          ))}\r\n      </div>\r\n      <div className=\"goods-list__goods-container\">\r\n        {sortedGoods\r\n          .slice(firstGoodsOnPageIndex, firstGoodsOnPageIndex + GOODS_ON_PAGE)\r\n          .map(\r\n            ({\r\n              _id,\r\n              title,\r\n              price,\r\n              stockPrice,\r\n              link,\r\n              previewImage,\r\n              secondImage,\r\n            }) => (\r\n              <GoodsItem\r\n                key={_id}\r\n                title={title}\r\n                link={link}\r\n                photo={previewImage.path}\r\n                secondPhoto={secondImage?.path || undefined}\r\n                price={price}\r\n                stockPrice={stockPrice}\r\n              />\r\n            )\r\n          )}\r\n      </div>\r\n      <div className=\"goods-list__pages-buttons\">\r\n        {currentPage > 1 && (\r\n          <div\r\n            role=\"presentation\"\r\n            onClick={() => changePage(currentPage - 1)}\r\n            className=\"chevron-left\"\r\n          ></div>\r\n        )}\r\n        {visiblePages.map((pageNum) => (\r\n          <div key={pageNum} className=\"page-number\">\r\n            <p\r\n              role=\"presentation\"\r\n              onClick={() => changePage(pageNum)}\r\n              className={pageNum === currentPage ? 'selected' : ''}\r\n            >\r\n              {pageNum}\r\n            </p>\r\n          </div>\r\n        ))}\r\n        {currentPage < maxPageNumber - 1 && (\r\n          <div\r\n            role=\"presentation\"\r\n            onClick={() => changePage(currentPage + 1)}\r\n            className=\"chevron-right\"\r\n          ></div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport const GoodsListFallback = () => {\r\n  return (\r\n    <div className=\"goods-list-fallback\">\r\n      <div className=\"goods-list-fallback__goods-container\">\r\n        {Array.from({ length: 9 }, (_, index) => (\r\n          <GoodsItemFallback key={index} />\r\n        ))}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default GoodsList;\r\n"]},"metadata":{},"sourceType":"module"}