{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"D:\\\\archivegit\\\\blind-blind\\\\src\\\\components\\\\Goods\\\\GoodsList.tsx\";\nimport { useEffect, useState } from 'react';\nimport { useRouter } from 'next/router';\nimport GoodsItem, { GoodsItemFallback } from './GoodsItem';\nimport Dropdown from '../Form/Dropdown';\nimport SuccessSVG from '../../assets/svg/success.svg';\nimport CrossSVG from '../../assets/svg/cross.svg';\nimport { SORT_GOODS, SORT_TRANSLATE } from '../../constants/sortGoods';\nimport { TRANSLATE } from '../../constants/languages';\nconst GOODS_ON_PAGE = 12;\nconst AVAILABLE_PAGES = 3;\n\nconst GoodsList = ({\n  goods,\n  categories\n}) => {\n  const {\n    0: sortSelect,\n    1: setSortSelect\n  } = useState('default');\n  const router = useRouter();\n  const {\n    locale,\n    query\n  } = router;\n  const {\n    0: isCategoriesOpen,\n    1: setCategoriesOpen\n  } = useState(false);\n  const {\n    0: selectedCategories,\n    1: setSelectedCategories\n  } = useState([]);\n  const {\n    0: currentPage,\n    1: setCurrentPage\n  } = useState(1);\n  const {\n    0: visiblePages,\n    1: setVisiblePages\n  } = useState([]);\n  const {\n    0: firstGoodsOnPageIndex,\n    1: setFirstGoodsOnPageIndex\n  } = useState(1);\n  const filteredGoods = goods === null || goods === void 0 ? void 0 : goods.entries.filter(({\n    categories\n  }) => selectedCategories.length == 0 || Array.isArray(categories) && categories.reduce((prev, {\n    _id\n  }) => selectedCategories.includes(_id) || prev, false));\n  const sortedGoods = SORT_GOODS[sortSelect](filteredGoods);\n  const maxPageNumber = Math.ceil((sortedGoods === null || sortedGoods === void 0 ? void 0 : sortedGoods.length) / GOODS_ON_PAGE);\n  useEffect(() => {\n    const outsideClick = () => setCategoriesOpen(() => false);\n\n    document && document.addEventListener('click', outsideClick, {\n      passive: true\n    });\n    return () => document && document.removeEventListener('click', outsideClick);\n  }, []);\n  useEffect(() => {\n    setFirstGoodsOnPageIndex((currentPage - 1) * GOODS_ON_PAGE);\n    if (maxPageNumber <= 1) setVisiblePages([]);else if (currentPage + 1 + AVAILABLE_PAGES >= maxPageNumber) setVisiblePages([...Array(maxPageNumber + 1).keys()].splice(maxPageNumber > AVAILABLE_PAGES ? maxPageNumber - AVAILABLE_PAGES : 1, maxPageNumber));else if (currentPage + 1 - AVAILABLE_PAGES <= 0) setVisiblePages([...Array(maxPageNumber + 1).keys()].splice(1, AVAILABLE_PAGES));else setVisiblePages([...Array(maxPageNumber + 1).keys()].splice(currentPage - Math.floor(AVAILABLE_PAGES / 2), currentPage + Math.ceil(AVAILABLE_PAGES / 2) - 1));\n  }, [currentPage, maxPageNumber]);\n  useEffect(() => {\n    const page = query.page ? Number.parseInt(query.page) : 0;\n    setCurrentPage(page && page < maxPageNumber + 1 ? page : 1);\n  }, [query.page, maxPageNumber]);\n  useEffect(() => {\n    if (selectedCategories.length) {\n      setCurrentPage(1);\n      const newQuery = router.query;\n      newQuery['page'] = '1';\n      router.push({\n        pathname: router.pathname,\n        query: newQuery\n      });\n    }\n  }, [selectedCategories]);\n\n  const changePage = pageNum => {\n    const newQuery = router.query;\n\n    if (!pageNum) {\n      delete newQuery.page;\n    } else {\n      newQuery['page'] = pageNum.toString();\n    }\n\n    router.push({\n      pathname: router.pathname,\n      query: newQuery\n    });\n    window.scrollTo({\n      top: 0,\n      behavior: 'smooth'\n    });\n  };\n\n  const setSort = item => {\n    setSortSelect(Object.keys(SORT_TRANSLATE).find(key => SORT_TRANSLATE[key][locale] === item));\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"goods-list\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"input-select\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        role: \"presentation\",\n        className: \"dropdown\",\n        onClick: e => {\n          e.stopPropagation();\n          setCategoriesOpen(prev => !prev);\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"dropdown__value\",\n          children: [TRANSLATE[locale].goodsCaterories, /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"dropdown-button\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 134,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 132,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: `dropdown__list goods-list-categories__list ${isCategoriesOpen ? 'open' : ''}`,\n          children: categories.map(({\n            _id,\n            title\n          }) => /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"goods-list-categories__list-item\",\n            role: \"presentation\",\n            onClick: () => {\n              setSelectedCategories(prev => prev.includes(_id) ? prev.filter(id => id != _id) : [...prev, _id]);\n            },\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"goods-list-categories__list-item-label\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: `goods-list-categories__list-item-label-box ${selectedCategories.includes(_id) ? 'goods-list-categories__list-item-label-box-selected' : ''}`,\n                children: /*#__PURE__*/_jsxDEV(SuccessSVG, {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 162,\n                  columnNumber: 21\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 155,\n                columnNumber: 19\n              }, this), title]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 154,\n              columnNumber: 17\n            }, this)\n          }, _id, false, {\n            fileName: _jsxFileName,\n            lineNumber: 142,\n            columnNumber: 15\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 136,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 124,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Dropdown, {\n        value: SORT_TRANSLATE[sortSelect][locale],\n        values: Object.keys(SORT_TRANSLATE).map(key => SORT_TRANSLATE[key][locale]),\n        setValue: setSort\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 171,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 123,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"goods-list__categories\",\n      children: categories.filter(({\n        _id\n      }) => selectedCategories.includes(_id)).map(({\n        _id,\n        title\n      }) => /*#__PURE__*/_jsxDEV(\"div\", {\n        role: \"presentation\",\n        className: \"goods-list__categories-title\",\n        onClick: () => setSelectedCategories(prev => prev.filter(id => id != _id)),\n        children: [title, /*#__PURE__*/_jsxDEV(CrossSVG, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 195,\n          columnNumber: 15\n        }, this)]\n      }, _id, true, {\n        fileName: _jsxFileName,\n        lineNumber: 186,\n        columnNumber: 13\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 182,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"goods-list__goods-container\",\n      children: sortedGoods.slice(firstGoodsOnPageIndex, firstGoodsOnPageIndex + GOODS_ON_PAGE).map(({\n        _id,\n        title,\n        price,\n        stockPrice,\n        link,\n        previewImage,\n        secondImage\n      }) => /*#__PURE__*/_jsxDEV(GoodsItem, {\n        title: title,\n        link: link,\n        photo: previewImage.path,\n        secondPhoto: (secondImage === null || secondImage === void 0 ? void 0 : secondImage.path) || undefined,\n        price: price,\n        stockPrice: stockPrice\n      }, _id, false, {\n        fileName: _jsxFileName,\n        lineNumber: 212,\n        columnNumber: 15\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 199,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"goods-list__pages-buttons\",\n      children: [currentPage > 1 && /*#__PURE__*/_jsxDEV(\"div\", {\n        role: \"presentation\",\n        onClick: () => changePage(currentPage - 1),\n        className: \"chevron-left\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 226,\n        columnNumber: 11\n      }, this), visiblePages.map(pageNum => /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"page-number\",\n        children: /*#__PURE__*/_jsxDEV(\"p\", {\n          role: \"presentation\",\n          onClick: () => changePage(pageNum),\n          className: pageNum === currentPage ? 'selected' : '',\n          children: pageNum\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 234,\n          columnNumber: 13\n        }, this)\n      }, pageNum, false, {\n        fileName: _jsxFileName,\n        lineNumber: 233,\n        columnNumber: 11\n      }, this)), currentPage < maxPageNumber - 1 && /*#__PURE__*/_jsxDEV(\"div\", {\n        role: \"presentation\",\n        onClick: () => changePage(currentPage + 1),\n        className: \"chevron-right\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 244,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 224,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 122,\n    columnNumber: 5\n  }, this);\n};\n\nexport const GoodsListFallback = () => {\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"goods-list-fallback\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"goods-list-fallback__goods-container\",\n      children: Array.from({\n        length: 9\n      }, (_, index) => /*#__PURE__*/_jsxDEV(GoodsItemFallback, {}, index, false, {\n        fileName: _jsxFileName,\n        lineNumber: 260,\n        columnNumber: 11\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 258,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 257,\n    columnNumber: 5\n  }, this);\n};\nexport default GoodsList;","map":{"version":3,"sources":["D:/archivegit/blind-blind/src/components/Goods/GoodsList.tsx"],"names":["useEffect","useState","useRouter","GoodsItem","GoodsItemFallback","Dropdown","SuccessSVG","CrossSVG","SORT_GOODS","SORT_TRANSLATE","TRANSLATE","GOODS_ON_PAGE","AVAILABLE_PAGES","GoodsList","goods","categories","sortSelect","setSortSelect","router","locale","query","isCategoriesOpen","setCategoriesOpen","selectedCategories","setSelectedCategories","currentPage","setCurrentPage","visiblePages","setVisiblePages","firstGoodsOnPageIndex","setFirstGoodsOnPageIndex","filteredGoods","entries","filter","length","Array","isArray","reduce","prev","_id","includes","sortedGoods","maxPageNumber","Math","ceil","outsideClick","document","addEventListener","passive","removeEventListener","keys","splice","floor","page","Number","parseInt","newQuery","push","pathname","changePage","pageNum","toString","window","scrollTo","top","behavior","setSort","item","Object","find","key","e","stopPropagation","goodsCaterories","map","title","id","slice","price","stockPrice","link","previewImage","secondImage","path","undefined","GoodsListFallback","from","_","index"],"mappings":"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","sourcesContent":["import { useEffect, useState } from 'react';\r\nimport { useRouter } from 'next/router';\r\n\r\nimport GoodsItem, { GoodsItemFallback } from './GoodsItem';\r\nimport Dropdown from '../Form/Dropdown';\r\n\r\nimport { ICockpitGoodsRaw } from '../../cockpitTypes';\r\nimport { IGoodsListProps } from './Types';\r\n\r\nimport SuccessSVG from '../../assets/svg/success.svg';\r\nimport CrossSVG from '../../assets/svg/cross.svg';\r\n\r\nimport { SORT_GOODS, SORT_TRANSLATE } from '../../constants/sortGoods';\r\nimport { TRANSLATE } from '../../constants/languages';\r\n\r\nconst GOODS_ON_PAGE = 12;\r\nconst AVAILABLE_PAGES = 3;\r\n\r\nconst GoodsList: React.FC<IGoodsListProps> = ({ goods, categories }) => {\r\n  const [sortSelect, setSortSelect] = useState<keyof typeof SORT_TRANSLATE>(\r\n    'default'\r\n  );\r\n  const router = useRouter();\r\n  const { locale, query } = router;\r\n\r\n  const [isCategoriesOpen, setCategoriesOpen] = useState(false);\r\n  const [selectedCategories, setSelectedCategories] = useState<string[]>([]);\r\n\r\n  const [currentPage, setCurrentPage] = useState(1);\r\n  const [visiblePages, setVisiblePages] = useState<Array<number>>([]);\r\n  const [firstGoodsOnPageIndex, setFirstGoodsOnPageIndex] = useState(1);\r\n\r\n  const filteredGoods = goods?.entries.filter(\r\n    ({ categories }) =>\r\n      selectedCategories.length == 0 ||\r\n      (Array.isArray(categories) &&\r\n        categories.reduce<boolean>(\r\n          (prev, { _id }) => selectedCategories.includes(_id) || prev,\r\n          false\r\n        ))\r\n  );\r\n\r\n  const sortedGoods = SORT_GOODS[sortSelect](\r\n    filteredGoods as ICockpitGoodsRaw[]\r\n  );\r\n\r\n  const maxPageNumber = Math.ceil(sortedGoods?.length / GOODS_ON_PAGE);\r\n\r\n  useEffect(() => {\r\n    const outsideClick = () => setCategoriesOpen(() => false);\r\n    document &&\r\n      document.addEventListener('click', outsideClick, { passive: true });\r\n    return () =>\r\n      document && document.removeEventListener('click', outsideClick);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    setFirstGoodsOnPageIndex((currentPage - 1) * GOODS_ON_PAGE);\r\n    if (maxPageNumber <= 1) setVisiblePages([]);\r\n    else if (currentPage + 1 + AVAILABLE_PAGES >= maxPageNumber)\r\n      setVisiblePages(\r\n        [...Array(maxPageNumber + 1).keys()].splice(\r\n          maxPageNumber > AVAILABLE_PAGES ? maxPageNumber - AVAILABLE_PAGES : 1,\r\n          maxPageNumber\r\n        )\r\n      );\r\n    else if (currentPage + 1 - AVAILABLE_PAGES <= 0)\r\n      setVisiblePages(\r\n        [...Array(maxPageNumber + 1).keys()].splice(1, AVAILABLE_PAGES)\r\n      );\r\n    else\r\n      setVisiblePages(\r\n        [...Array(maxPageNumber + 1).keys()].splice(\r\n          currentPage - Math.floor(AVAILABLE_PAGES / 2),\r\n          currentPage + Math.ceil(AVAILABLE_PAGES / 2) - 1\r\n        )\r\n      );\r\n  }, [currentPage, maxPageNumber]);\r\n\r\n  useEffect(() => {\r\n    const page = query.page ? Number.parseInt(query.page as string) : 0;\r\n    setCurrentPage(page && page < maxPageNumber + 1 ? page : 1);\r\n  }, [query.page, maxPageNumber]);\r\n\r\n  useEffect(() => {\r\n    if (selectedCategories.length) {\r\n      setCurrentPage(1);\r\n      const newQuery = router.query;\r\n      newQuery['page'] = '1';\r\n      router.push({ pathname: router.pathname, query: newQuery });\r\n    }\r\n  }, [selectedCategories]);\r\n\r\n  const changePage = (pageNum: number) => {\r\n    const newQuery = router.query;\r\n    if (!pageNum) {\r\n      delete newQuery.page;\r\n    } else {\r\n      newQuery['page'] = pageNum.toString();\r\n    }\r\n\r\n    router.push({\r\n      pathname: router.pathname,\r\n      query: newQuery,\r\n    });\r\n\r\n    window.scrollTo({ top: 0, behavior: 'smooth' });\r\n  };\r\n\r\n  const setSort = (item: string) => {\r\n    setSortSelect(\r\n      Object.keys(SORT_TRANSLATE).find(\r\n        (key) =>\r\n          SORT_TRANSLATE[key as keyof typeof SORT_TRANSLATE][\r\n            locale as 'ru' | 'en'\r\n          ] === item\r\n      ) as keyof typeof SORT_TRANSLATE\r\n    );\r\n  };\r\n\r\n  return (\r\n    <div className=\"goods-list\">\r\n      <div className=\"input-select\">\r\n        <div\r\n          role=\"presentation\"\r\n          className=\"dropdown\"\r\n          onClick={(e) => {\r\n            e.stopPropagation();\r\n            setCategoriesOpen((prev) => !prev);\r\n          }}\r\n        >\r\n          <div className=\"dropdown__value\">\r\n            {TRANSLATE[locale as 'ru' | 'en'].goodsCaterories}\r\n            <div className=\"dropdown-button\" />\r\n          </div>\r\n          <div\r\n            className={`dropdown__list goods-list-categories__list ${\r\n              isCategoriesOpen ? 'open' : ''\r\n            }`}\r\n          >\r\n            {categories.map(({ _id, title }) => (\r\n              <div\r\n                key={_id}\r\n                className=\"goods-list-categories__list-item\"\r\n                role=\"presentation\"\r\n                onClick={() => {\r\n                  setSelectedCategories((prev) =>\r\n                    prev.includes(_id)\r\n                      ? prev.filter((id) => id != _id)\r\n                      : [...prev, _id]\r\n                  );\r\n                }}\r\n              >\r\n                <div className=\"goods-list-categories__list-item-label\">\r\n                  <div\r\n                    className={`goods-list-categories__list-item-label-box ${\r\n                      selectedCategories.includes(_id)\r\n                        ? 'goods-list-categories__list-item-label-box-selected'\r\n                        : ''\r\n                    }`}\r\n                  >\r\n                    <SuccessSVG />\r\n                  </div>\r\n\r\n                  {title}\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </div>\r\n        <Dropdown\r\n          value={SORT_TRANSLATE[sortSelect][locale as 'ru' | 'en']}\r\n          values={Object.keys(SORT_TRANSLATE).map(\r\n            (key) =>\r\n              SORT_TRANSLATE[key as keyof typeof SORT_TRANSLATE][\r\n                locale as 'ru' | 'en'\r\n              ]\r\n          )}\r\n          setValue={setSort}\r\n        />\r\n      </div>\r\n      <div className=\"goods-list__categories\">\r\n        {categories\r\n          .filter(({ _id }) => selectedCategories.includes(_id))\r\n          .map(({ _id, title }) => (\r\n            <div\r\n              role=\"presentation\"\r\n              key={_id}\r\n              className=\"goods-list__categories-title\"\r\n              onClick={() =>\r\n                setSelectedCategories((prev) => prev.filter((id) => id != _id))\r\n              }\r\n            >\r\n              {title}\r\n              <CrossSVG />\r\n            </div>\r\n          ))}\r\n      </div>\r\n      <div className=\"goods-list__goods-container\">\r\n        {sortedGoods\r\n          .slice(firstGoodsOnPageIndex, firstGoodsOnPageIndex + GOODS_ON_PAGE)\r\n          .map(\r\n            ({\r\n              _id,\r\n              title,\r\n              price,\r\n              stockPrice,\r\n              link,\r\n              previewImage,\r\n              secondImage,\r\n            }) => (\r\n              <GoodsItem\r\n                key={_id}\r\n                title={title}\r\n                link={link}\r\n                photo={previewImage.path}\r\n                secondPhoto={secondImage?.path || undefined}\r\n                price={price}\r\n                stockPrice={stockPrice}\r\n              />\r\n            )\r\n          )}\r\n      </div>\r\n      <div className=\"goods-list__pages-buttons\">\r\n        {currentPage > 1 && (\r\n          <div\r\n            role=\"presentation\"\r\n            onClick={() => changePage(currentPage - 1)}\r\n            className=\"chevron-left\"\r\n          ></div>\r\n        )}\r\n        {visiblePages.map((pageNum) => (\r\n          <div key={pageNum} className=\"page-number\">\r\n            <p\r\n              role=\"presentation\"\r\n              onClick={() => changePage(pageNum)}\r\n              className={pageNum === currentPage ? 'selected' : ''}\r\n            >\r\n              {pageNum}\r\n            </p>\r\n          </div>\r\n        ))}\r\n        {currentPage < maxPageNumber - 1 && (\r\n          <div\r\n            role=\"presentation\"\r\n            onClick={() => changePage(currentPage + 1)}\r\n            className=\"chevron-right\"\r\n          ></div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport const GoodsListFallback = () => {\r\n  return (\r\n    <div className=\"goods-list-fallback\">\r\n      <div className=\"goods-list-fallback__goods-container\">\r\n        {Array.from({ length: 9 }, (_, index) => (\r\n          <GoodsItemFallback key={index} />\r\n        ))}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default GoodsList;\r\n"]},"metadata":{},"sourceType":"module"}