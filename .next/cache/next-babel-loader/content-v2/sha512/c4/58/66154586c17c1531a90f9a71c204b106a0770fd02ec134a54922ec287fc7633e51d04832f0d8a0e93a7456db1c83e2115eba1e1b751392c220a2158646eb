{"ast":null,"code":"import _regeneratorRuntime from \"C:/Users/user/Documents/GitHub/blind-blind/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"C:/Users/user/Documents/GitHub/blind-blind/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport _defineProperty from \"C:/Users/user/Documents/GitHub/blind-blind/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport _toConsumableArray from \"C:/Users/user/Documents/GitHub/blind-blind/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { useContext, useEffect, useState } from 'react';\nimport App from 'next/app';\nimport NextNprogress from 'nextjs-progressbar';\nimport Header from '../src/components/Header/Header';\nimport Footer from '../src/components/Footer/Footer';\nimport ModalWindowStart from '../src/components/ModalWindowStart/ModalWindowStart';\nimport ArrowUp from '../src/components/ArrowUp/ArrowUp';\nimport { cartContext } from '../src/context/cartContext';\nimport { indexContext } from '../src/context/cockpitContext';\nimport { currencyContext } from '../src/context/currencyContext';\nimport { getCockpitCollection } from '../src/utils/getCockpitData';\nimport { getCurrencyRate } from '../src/utils/getCurrencyRate';\nimport '../styles/main.scss';\nimport '../styles/intlTelInput.css';\n\nvar MyApp = function MyApp(_ref) {\n  var Component = _ref.Component,\n      pageProps = _ref.pageProps,\n      _ref$props = _ref.props,\n      collections = _ref$props.collections,\n      runways = _ref$props.runways,\n      hasStocks = _ref$props.hasStocks;\n  var curCartContext = useContext(cartContext);\n\n  var _useState = useState(curCartContext ? curCartContext.cart : []),\n      cartState = _useState[0],\n      setCartState = _useState[1];\n\n  var _useState2 = useState(0),\n      USDRate = _useState2[0],\n      changeUSDRate = _useState2[1];\n\n  var _useState3 = useState('UAH'),\n      currency = _useState3[0],\n      setCurrency = _useState3[1];\n\n  var _useState4 = useState(0),\n      currencyRate = _useState4[0],\n      setCurrencyRate = _useState4[1];\n\n  var addItemToCart = function addItemToCart(item) {\n    if (!('receiverName' in item)) {\n      var existingItem = cartState.filter(function (el) {\n        return el.id === item.id && !('receiverName' in el) && JSON.stringify(el.details) === JSON.stringify(item.details);\n      });\n\n      if (existingItem.length) {\n        var newItem = existingItem[0];\n        cartState.forEach(function (el) {\n          if (el.id === newItem.id && JSON.stringify(el.details) === JSON.stringify(newItem.details)) el.amount += 1;\n        });\n        setCartState(_toConsumableArray(cartState));\n        return;\n      }\n    }\n\n    setCartState([].concat(_toConsumableArray(cartState), [item]));\n  };\n\n  var removeItemFromCart = function removeItemFromCart(item) {\n    if (!('receiverName' in item)) setCartState(_toConsumableArray(cartState.filter(function (el) {\n      return !(el.id === item.id && JSON.stringify(el.details) === JSON.stringify(item.details));\n    })));else setCartState(_toConsumableArray(cartState.filter(function (el) {\n      return el.id !== item.id;\n    })));\n  };\n\n  var clearCart = function clearCart() {\n    return setCartState([]);\n  };\n\n  useEffect(function () {\n    if (true) {\n      var storageCart = localStorage.getItem('cart');\n\n      if (storageCart) {\n        setCartState(JSON.parse(storageCart));\n      }\n\n      var storageCurrency = localStorage.getItem('currency');\n\n      if (storageCurrency) {\n        setCurrency(JSON.parse(storageCurrency));\n      }\n    }\n  }, []);\n  useEffect(function () {\n    if (!USDRate) getCurrencyRate('USD').then(function (res) {\n      return changeUSDRate(+res);\n    });\n  }, []);\n  useEffect(function () {\n    if (true) {\n      localStorage.setItem('cart', JSON.stringify(cartState));\n      localStorage.setItem('currency', JSON.stringify(currency));\n    }\n  }, [cartState, currency]);\n  useEffect(function () {\n    getCurrencyRate(currency.toString()).then(function (res) {\n      if (currency.toString() === 'RUB') {\n        setCurrencyRate(function () {\n          return 1 / 3;\n        });\n      } else {\n        setCurrencyRate(+res);\n      }\n    })[\"catch\"](function (err) {\n      return console.error(err);\n    });\n  }, [currency]);\n  return /*#__PURE__*/_jsx(indexContext.Provider, {\n    value: {\n      collectionsData: collections,\n      runwaysData: runways,\n      hasStocks: hasStocks\n    },\n    children: /*#__PURE__*/_jsx(currencyContext.Provider, {\n      value: {\n        currency: currency,\n        currencyRate: currencyRate,\n        setCurrency: setCurrency,\n        USDRate: USDRate\n      },\n      children: /*#__PURE__*/_jsxs(cartContext.Provider, {\n        value: {\n          cart: cartState,\n          addItem: addItemToCart,\n          removeItem: removeItemFromCart,\n          clearCart: clearCart\n        },\n        children: [/*#__PURE__*/_jsx(\"noscript\", {\n          dangerouslySetInnerHTML: {\n            __html: \"<iframe\\n              src=\\\"https://www.googletagmanager.com/ns.html?id=GTM-5XP658M\\\"\\n              height=\\\"0\\\"\\n              width=\\\"0\\\"\\n              style=\\\"display:none;visibility:hidden\\\"\\n            ></iframe>\"\n          }\n        }), /*#__PURE__*/_jsx(Header, {}), /*#__PURE__*/_jsx(ModalWindowStart, {}), /*#__PURE__*/_jsx(NextNprogress, {\n          color: \"#000\",\n          startPosition: 0.3,\n          stopDelayMs: 200,\n          height: 3\n        }), /*#__PURE__*/_jsx(\"main\", {\n          children: /*#__PURE__*/_jsx(Component, _objectSpread({}, pageProps))\n        }), /*#__PURE__*/_jsx(ArrowUp, {}), /*#__PURE__*/_jsx(Footer, {})]\n      })\n    })\n  });\n};\n\nMyApp.getInitialProps = /*#__PURE__*/function () {\n  var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(appContext) {\n    var appProps, _appContext$router, locale, defaultLocale, cockpitDataCollections, cockpitGoods, cockpitDataRunways, stockGoods, runways, collections;\n\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return App.getInitialProps(appContext);\n\n          case 2:\n            appProps = _context.sent;\n            _appContext$router = appContext.router, locale = _appContext$router.locale, defaultLocale = _appContext$router.defaultLocale;\n            _context.next = 6;\n            return getCockpitCollection('Collections', 'filter[inMenu]=true&sort[_o]=1');\n\n          case 6:\n            cockpitDataCollections = _context.sent;\n            _context.next = 9;\n            return getCockpitCollection('Goods');\n\n          case 9:\n            cockpitGoods = _context.sent;\n            _context.next = 12;\n            return getCockpitCollection('Runways', 'filter[inMenu]=true');\n\n          case 12:\n            cockpitDataRunways = _context.sent;\n            stockGoods = cockpitGoods.entries.filter(function (_ref3) {\n              var stockPrice = _ref3.stockPrice;\n              return stockPrice;\n            });\n            runways = cockpitDataRunways.entries.map(function (el) {\n              return {\n                title: locale === defaultLocale ? el.title : el.title_en,\n                link: '/blind-style' + el.link,\n                inMenu: el.inMenu\n              };\n            });\n            collections = cockpitDataCollections.entries.map(function (el) {\n              return {\n                title: locale === defaultLocale ? el.title : el.title_en,\n                link: \"/collections\".concat(el.link),\n                inMenu: el.inMenu,\n                _id: el._id\n              };\n            });\n            return _context.abrupt(\"return\", _objectSpread(_objectSpread({}, appProps), {}, {\n              props: {\n                collections: collections,\n                runways: runways,\n                hasStocks: !!stockGoods.length\n              }\n            }));\n\n          case 17:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function (_x) {\n    return _ref2.apply(this, arguments);\n  };\n}();\n\nexport default MyApp;","map":null,"metadata":{},"sourceType":"module"}